function FetchXHR() {
  this.options = {};
}

var prototype = FetchXHR.prototype;

prototype.open = function(method, url) {
  this.options.method = method;
  this.url = url;
}

prototype.setRequestHeader = function(key, value) {
  if (!this.options.headers) {
    var headers = {};
    headers[key] = value;
    this.options.headers = new Headers(headers);
  } else {
    this.options.headers.set(key, value);
  }
}

prototype.send = function(body) {
  this.options.body = body;
  var request = new Request(this.url, this.options);
  var self = this;

  fetch(request).then(function(response){
    self.readyState = 4;
    self.status = response.status;
    return response.text();
  }).then(function(text){
    self.responseText = text;
    if (self.onreadystatechange) self.onreadystatechange();
  }).catch(function(err){
    throw("Request failure: " + err);
  });
}


module.exports = FetchXHR;
